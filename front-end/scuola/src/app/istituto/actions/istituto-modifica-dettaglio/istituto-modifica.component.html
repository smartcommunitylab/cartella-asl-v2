<div class="mb-3 list-container md-margin sub-navbar-content-below m16">
    <div class="row" *ngIf="istituto">
        <div class="col-6 v-center">
            <span class="modifyTitleStyle m-left">{{istituto.name}}</span>&nbsp;&nbsp;
        </div>
        <div class="col-6">
            <div class="row v-center float-right">
                <button type="button" class="btn btn-danger btn-icon btn-xs btnAnnulla m-top22" placement="bottom"
                    ngbTooltip="Annulla le modifiche" (click)="cancel()">
                    <span class="row btnModificationText">
                        <span class="col-8 leftItem">Annulla</span>
                        <span class="col-4 rightItem">
                            <svg class="icon icon-white icon-sm btnModificationIcon">
                                <use xlink:href="assets/bootstrap-italia/svg/sprite.svg#it-close-big"></use>
                            </svg>
                        </span>
                    </span>
                </button>
                &nbsp;&nbsp;
                <button class="btn btn-success btn-icon btn-xs btnSave m-top22" placement="bottom"
                    ngbTooltip="Modifica l'istituto" (click)="save(myForm)">
                    <span class="row btnModificationText">
                        <span class="col-8 leftItem">Salva</span>
                        <span class="col-4 rightItem">
                            <i class="material-icons btnModificationIcon">save</i>
                        </span>
                    </span>
                </button>
            </div>
        </div>
    </div>
    <hr class="hr modifyHr" />
    <div class="row m-subNav">
        <div class="col-12">
            <sub-navbar [breadcrumbItems]="breadcrumbItems"></sub-navbar>
        </div>
    </div>
    <div class="card-body modify-card-body" *ngIf="istituto">
        <div class="errorMsg" [hidden]="!forceErrorDisplay">Compila i campi necessari</div>
        <span class="row v-center modal-title modalSubject">Dati Istituto</span>
        <div class="row m16">
            <div class="col-12">
                <form #istitutoForm="ngForm" id="istitutoForm">

                    <div class="row v-center form-group">
                        <div class="col-sm-5"
                            [class.has-danger]="NomeInput.invalid && (NomeInput.dirty || NomeInput.touched || forceErrorDisplay)">
                            <label for="nome" *ngIf="istituto.nome" class="active">Nome</label>
                            <input type="text" class="form-control" [(ngModel)]="istituto.name" id="nome" name="nome"
                                #NomeInput="ngModel" placeholder="Nome" required>
                            <div class="invalid-feedback"
                                [class.d-block]="forceTitoloErrorDisplay || (NomeInput.invalid && (NomeInput.dirty || NomeInput.touched || forceErrorDisplay))">
                                Campo necessario.</div>
                        </div>
                        <div class="col-2"></div>
                        <div class="col-sm-5"
                            [class.has-danger]="EmailInput.invalid && (EmailInput.dirty || EmailInput.touched || forceErrorDisplay)">
                            <label for="email" *ngIf="istituto.email" class="active">Email</label>
                            <input type="text" class="form-control" [(ngModel)]="istituto.email" id="email" name="email"
                                #EmailInput="ngModel" placeholder="Email" required>
                            <div class="invalid-feedback"
                                [class.d-block]="forceErrorDisplayMail || (EmailInput.invalid && (EmailInput.dirty || EmailInput.touched || forceErrorDisplay))">
                                Campo necessario.
                            </div>
                        </div>
                    </div>
                    <div class="row v-center form-group">
                        <div class="col-sm-3"
                            [class.has-danger]="partitaIvaInputLocale.invalid && (partitaIvaInputLocale.dirty || partitaIvaInputLocale.touched || forceErrorDisplay)">
                            <label for="partitaIva" *ngIf="istituto.cf" class="active">Partita Iva</label>
                            <input type="text" class="form-control" pattern="[0-9]*" minlength="11" maxlength="11"
                                [(ngModel)]="istituto.cf" id="partitaIvaLocale" name="partitaIvaLocale"
                                #partitaIvaInputLocale="ngModel" placeholder="Partita Iva" required>
                            <div class="invalid-feedback"
                                [class.d-block]="partitaIvaInputLocale.invalid && (partitaIvaInputLocale.dirty || partitaIvaInputLocale.touched || forceErrorDisplay)">
                                Campo necessario (11 numeri).</div>
                        </div>
                        <div class="col-sm-2">
                        </div>
                        <div class="col-sm-2"></div>
                        <div class="col-sm-5"
                            [class.has-danger]="PECInput.invalid && (PECInput.dirty || PECInput.touched || forceErrorDisplay)">
                            <label for="pec" *ngIf="istituto.pec" class="active">PEC</label>
                            <input type="text" class="form-control" [(ngModel)]="istituto.pec" id="pec" name="pec"
                                #PECInput="ngModel" placeholder="PEC">
                        </div>
                    </div>
                    <div class="row v-center form-group">
                        <div class="col-sm-5"
                            [class.has-danger]="PrivacyLinkRDPInput.invalid && (PrivacyLinkRDPInput.dirty || PrivacyLinkRDPInput.touched || forceErrorDisplay)">
                            <label for="PrivacyLinkRDP" *ngIf="istituto.privacyLink" class="active">Informativa privacy</label>
                            <input type="text" class="form-control" [(ngModel)]="istituto.privacyLink" id="privacyLinkRDP" name="privacyLinkRDP"
                                #PrivacyLinkRDPInput="ngModel" placeholder="Informativa privacy link">
                        </div>
                        <div class="col-2"></div>
                        <div class="col-sm-5"
                            [class.has-danger]="TelefonoInput.invalid && (TelefonoInput.dirty || TelefonoInput.touched || forceErrorDisplay)">
                            <label for="phone" *ngIf="istituto.phone" class="active">Telefono</label>
                            <input type="text" class="form-control" [(ngModel)]="istituto.phone" id="phone" name="phone"
                                #TelefonoInput="ngModel" placeholder="Telefono">
                        </div>
                    </div>
                    <div class="row v-center form-group">
                        <div class="col-sm-5"
                            [class.has-danger]="NomeRDPInput.invalid && (NomeRDPInput.dirty || NomeRDPInput.touched || forceErrorDisplay)">
                            <label for="nomeRDP" *ngIf="istituto.rdpName" class="active">Nome RDP</label>
                            <input type="text" class="form-control" [(ngModel)]="istituto.rdpName" id="nomeRDP" name="nomeRDP"
                                #NomeRDPInput="ngModel" placeholder="Nome RDP">
                            <!-- <div class="invalid-feedback"
                                [class.d-block]="forceTitoloErrorDisplay || (NomeRDPInput.invalid && (NomeRDPInput.dirty || NomeRDPInput.touched || forceErrorDisplay))">
                                Campo necessario.</div> -->
                        </div>
                        <div class="col-2"></div>
                        <div class="col-sm-5"
                            [class.has-danger]="EmailRDPInput.invalid && (EmailRDPInput.dirty || EmailRDPInput.touched || forceErrorDisplay)">
                            <label for="emailRDP" *ngIf="istituto.rdpEmail" class="active">Email RDP</label>
                            <input type="text" class="form-control" [(ngModel)]="istituto.rdpEmail" id="emailRDP" name="emailRDP"
                                #EmailRDPInput="ngModel" placeholder="Email RDP">
                            <!-- <div class="invalid-feedback"
                                [class.d-block]="forceErrorDisplayMail || (EmailRDPInput.invalid && (EmailRDPInput.dirty || EmailRDPInput.touched || forceErrorDisplay))">
                                Campo necessario.
                            </div> -->
                        </div>
                    </div>
                    <div class="row v-center form-group">
                        <div class="col-sm-5"
                            [class.has-danger]="IndirizzoRDPInput.invalid && (IndirizzoRDPInput.dirty || IndirizzoRDPInput.touched || forceErrorDisplay)">
                            <label for="IndirizzoRDP" *ngIf="istituto.rdpAddress" class="active">Indirizzo RDP</label>
                            <input type="text" class="form-control" [(ngModel)]="istituto.rdpAddress" id="indirizzoRDP" name="indirizzoRDP"
                                #IndirizzoRDPInput="ngModel" placeholder="Indirizzo RDP">
                        </div>
                        <div class="col-2"></div>
                        <div class="col-sm-5"
                            [class.has-danger]="TelefonoRDPInput.invalid && (TelefonoRDPInput.dirty || TelefonoRDPInput.touched || forceErrorDisplay)">
                            <label for="telefonoRDP" *ngIf="istituto.rdpPhoneFax" class="active">Telefono/Fax RDP</label>
                            <input type="text" class="form-control" [(ngModel)]="istituto.rdpPhoneFax" id="telefonoRDP" name="telefonoRDP"
                                #TelefonoRDPInput="ngModel" placeholder="Telefono/Fax RDP">
                        </div>
                    </div>
                    <div class="row v-center form-group">
                        <div class="col-sm-5"
                            [class.has-danger]="PECRDPInput.invalid && (PECRDPInput.dirty || PECRDPInput.touched || forceErrorDisplay)">
                            <label for="PECRDP" *ngIf="istituto.rdpPec" class="active">PEC RDP</label>
                            <input type="text" class="form-control" [(ngModel)]="istituto.rdpPec" id="PECRDP" name="PECRDP"
                                #PECRDPInput="ngModel" placeholder="PEC RDP">
                        </div>
                        <div class="col-2"></div>
                        <div class="col-sm-5"
                            [class.has-danger]="polizzaInailInput.invalid && (polizzaInailInput.dirty || polizzaInailInput.touched || forceErrorDisplay)">
                            <label for="polizzaInail" *ngIf="istituto.rdpPec" class="active">Polizza INAIL</label>
                            <input type="text" class="form-control" [(ngModel)]="istituto.polizzaInail" id="polizzaInail" name="polizzaInail"
                                #polizzaInailInput="ngModel" placeholder="Polizza INAIL">
                        </div>
                    </div>
                    <div class="row v-center form-group">
                        <div class="col-sm-5"
                            [class.has-danger]="rctPatInput.invalid && (rctPatInput.dirty || rctPatInput.touched || forceErrorDisplay)">
                            <label for="rctPat" *ngIf="istituto.rctPat" class="active">RCT PAT</label>
                            <input type="text" class="form-control" [(ngModel)]="istituto.rctPat" id="rctPat" name="rctPat"
                                #rctPatInput="ngModel" placeholder="RCT PAT">
                        </div>
                        <div class="col-2"></div>
                        <div class="col-sm-5"
                            [class.has-danger]="infortuniPatInput.invalid && (infortuniPatInput.dirty || infortuniPatInput.touched || forceErrorDisplay)">
                            <label for="infortuniPat" *ngIf="istituto.infortuniPat" class="active">Infortuni PAT</label>
                            <input type="text" class="form-control" [(ngModel)]="istituto.infortuniPat" id="infortuniPat" name="infortuniPat"
                                #infortuniPatInput="ngModel" placeholder="Infortuni PAT">
                        </div>
                    </div>
                    <div class="row v-center form-group">
                        <div class="col-5">
                            <ng-template #rtAddress let-place="result" let-term="term">
                                <div class="row">
                                    <ngb-highlight [result]="place.name" [term]="term"></ngb-highlight>
                                </div>
                            </ng-template>
                            <input type="text" class="form-control" [(ngModel)]="place" value="place.name"
                                id="luogoSvolgimento" name="luogoSvolgimento" [ngbTypeahead]="getAddresses"
                                [resultTemplate]="rtAddress" [inputFormatter]="formatterAddress"
                                (ngModelChange)="selectPlace(place)" required>
                            <small *ngIf="searching" class="progress-spinner progress-spinner-active size-sm">
                                <span class="sr-only">Caricamento...</span>
                            </small>
                            <label for="luogoSvolgimento" *ngIf="istituto.address" class="active">Posizione</label>
                            <label for="luogoSvolgimento" *ngIf="!istituto.address">Posizione</label>
                            <div class="invalid-feedback" [class.d-block]="forceAddressDisplay">Campo necessario.</div>
                        </div>                      
                    </div>
                </form>
            </div>
        </div>
        <br>
        <div class="p-1 middle-div row">
            <div class="col">
                <div id="map" style="height:300px;width:100%;"></div>
            </div>
        </div>

    </div>
</div>